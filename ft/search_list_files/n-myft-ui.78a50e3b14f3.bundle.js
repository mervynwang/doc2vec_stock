(window.webpackJsonp=window.webpackJsonp||[]).push([["n-myft-ui"],{"0461bd81":function(t,e,n){"use strict";n.r(e),n.d(e,"client",(function(){return o.default})),n.d(e,"ui",(function(){return r}));var r={};n.r(r),n.d(r,"init",(function(){return ut})),n.d(r,"personaliseLinks",(function(){return _})),n.d(r,"updateUi",(function(){return nt}));var o=n("dcfa7677"),a={saved:{actorType:"user",idProperty:"data-content-id",subjectType:"content",uiSelector:'[data-myft-ui="saved"]'},followed:{actorType:"user",idProperty:"data-concept-id",subjectType:"concept",uiSelector:'[data-myft-ui="follow"]'},contained:{actorType:"list",idProperty:"data-content-id",subjectType:"content",uiSelector:'[data-myft-ui="contained"]'}},i={};function c(t){return i[t]||[]}function u(t){return new Promise((function(e){var n=a[t].subjectType,r="".concat(t,".").concat(n);if(o.default.loaded[r])return i[t]=o.default.loaded[r],e();var c=function(){i[t]=o.default.loaded[r].items,e()},u="myft.user.".concat(t,".").concat(n,".load");document.body.addEventListener(u,c),setTimeout((function(){document.body.removeEventListener(u,c),e()}),5e3)}))}function l(t,e){i[t]?-1===d(t,e.uuid)&&i[t].push(e):i[t]=[e]}function s(t,e){var n=d(t,e);-1!==n&&i[t].splice(n,1)}var d=function(t,e){return i[t].findIndex((function(t){return t.uuid===e}))},f=n("2588dbc0"),b=n("99a4eb02"),m=n.n(b),y=function(){var t=m.a.get("FTSession_s")||m.a.get("FTSession");return t?t.slice(-36):""},v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.token,n=void 0===e?y():e,r=t.container,o=void 0===r?document.body:r,a=t.inputs,i=void 0===a?o.querySelectorAll("[data-myft-csrf-token]"):a;Array.from(i).forEach((function(t){t.value=n}))};function p(t,e){e!==("true"===t.getAttribute("aria-pressed"))&&f.toggleState(t),t.removeAttribute("disabled")}function h(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(a[t]){var c=a[t].uiSelector,u=a[t].idProperty,l=Array.from(r.querySelectorAll(c)).map((function(t){return t.closest("form")}));l.forEach((function(r){if(e.includes(r.getAttribute(u))){if(w(t,e[0],n,o),p(r.querySelector("button"),n),i){var a=r.querySelector(".n-myft-ui__announcement");a&&(a.innerHTML=a.dataset[n?"pressedText":"unpressedText"])}v({container:r})}}))}}function g(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return h(t,[e],n,r,o,a)}function w(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"followed"===t&&!0===n&&r.subject&&r.subject.properties&&l(t,r.subject.properties),"followed"===t&&!1===n&&s(t,e)}var A={concept:{idLabel:"concept_id",add:"follow",remove:"unfollow"},content:{idLabel:"article_id",add:"save",remove:"unsave"}},S=function(t,e,n,r){if("update"===e&&"concept"===t){var o=n&&n._rel&&n._rel.instant&&"true"===n._rel.instant?"on":"off";return"instant-alert-".concat(o)}return r&&r.rel&&r.rel.type&&"contained"===r.rel.type?"".concat(e,"-to-list-success"):A[t][e]};function x(t){if(-1!==Object.keys(A).indexOf(t.subjectType)){var e=Object.assign({action:S(t.subjectType,t.action,t.postedData,t.resultData)},t.trackingInfo),n=function(t,e){var n={};return n[A[t].idLabel]=e,n}(t.subjectType,t.subjectId);Object.assign(e,n),r=e,o=Object.assign({},r,{category:"myFT"}),document.body.dispatchEvent(new CustomEvent("oTracking.event",{detail:o,bubbles:!0}))}var r,o}var j=n("87ae850e"),k=n("1063c397"),T=n("33cab54f"),_=function(t){var e=t&&"A"===t.nodeName?[t]:Object(T.$$)('a[href^="/myft"]',t);return Promise.all(e.map((function(t){return o.default.personaliseUrl(t.getAttribute("href")).then((function(e){return t.setAttribute("href",e)}))})))};var E=a.followed.idProperty;function I(t,e){var n=t.getAttribute(E).split(","),r=e.name.split(","),o=e.directType?e.directType.split(","):[],a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}));return n.map((function(t,n){delete e.name,delete e.type;var i=Object.assign({name:r[n],_rel:{eventId:a,eventType:"coll-add-all"}},e);return o[n]&&(i.directType=o[n]),{id:t,formData:i}}))}var O,P=n("f9e8967f"),q=n.n(P),C=y(),D="https:"===document.location.protocol||document.location.href.indexOf("local")>=0,L=!1;function F(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}function U(t,e){return o.default.init().then((function(){return o.default.getAll("enabled","endpoint")})).then((function(n){var r=[],a=function(t){if(0!==t.endpoint.indexOf("https://android.googleapis.com/gcm/send"))return t.endpoint;var e=t.endpoint;return t.subscriptionId&&-1===t.endpoint.indexOf(t.subscriptionId)&&(e=t.endpoint+"/"+t.subscriptionId),e}(t);n&&n.items&&n.items.length&&(r=n.items);var i=t.getKey?btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("p256dh")))):"",c=t.getKey?btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("auth")))):"",u=r.indexOf(a);return e||!a&&u>=0?o.default.remove("user",null,"enabled","endpoint",encodeURIComponent(a),{token:C}):u<0&&o.default.add("user",null,"enabled","endpoint",encodeURIComponent(a),{authKey:i,authSecret:c,token:C}),!0}))}function N(t){if(L){document.body.dispatchEvent(new CustomEvent("oTracking.event",{detail:{category:"myFT",action:"offer-instant-alerts",permission:Notification.permission},bubbles:!0}));var e=q()("denied"===Notification.permission);e.context.addEventListener("oOverlay.ready",(function(){e.context.querySelector(".js-instant-alerts-confirmation-yes").addEventListener("click",(function(){e.destroy(),navigator.serviceWorker.ready.then((function(t){t.pushManager.subscribe(O).then((function(t){return U(t)}))})),function(t){o.default.init().then((function(){return o.default.add("user",null,"followed","concept",t,{token:C,_rel:{instant:"true"}})}))}(t)})),e.context.querySelector(".js-instant-alerts-confirmation-no").addEventListener("click",(function(){e.destroy()}))}),!1)}}function R(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}(t,e)||M(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(t){return function(t){if(Array.isArray(t))return W(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||M(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){if(t){if("string"==typeof t)return W(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W(t,e):void 0}}function W(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Y,J=function(t,e,n){if(!function(t){return t.querySelector("button").hasAttribute("disabled")}(e)){e.querySelector("button").setAttribute("disabled","");var r=function(t){return"true"===t.querySelector("button").getAttribute("aria-pressed")?"remove":"add"}(e),i=e.getAttribute("data-actor-id"),c=function(t){var e,n=t.querySelector("button"),r=t.querySelectorAll('input[type="hidden"]'),o=[n].concat(K(r));return e={},o.forEach((function(t){if(t.name)if(t.name.startsWith("_rel.")){var n=t.name.slice("_rel.".length);e._rel=e._rel||{},e._rel[n]=t.value}else e[t.name]=t.value})),e}(e),u=function(t){return(t.getAttribute("data-myft-tracking")||"").split(",").map((function(t){return t.split("=")})).reduce((function(t,e){var n=R(e,2),r=n[0],o=n[1],a=r&&r.trim(),i=o&&o.trim()||!0;return a&&i&&(t[a]=i),t}),{})}(e);if(function(t,e){return"followed"===t&&e.getAttribute(E).includes(",")}(t,e))return function(t,e,n,r,a){return Promise.all(I(n,r).map((function(n){return o.default[t]("user",e,"followed","concept",n.id,n.formData,a)}))).then((function(){return p(n.querySelector("button"),"add"===t)}))}(r,i,e,c,u);if("followPlusDigestEmail"===e.getAttribute("data-myft-ui-variant")&&"add"===r)return o.default.followPlusDigestEmail(e.getAttribute("data-concept-id"),c);var l=a[t],s=e.getAttribute(l.idProperty),d=l.actorType,f=l.subjectType;return e.elements.token&&e.elements.token.value||document.body.dispatchEvent(new CustomEvent("oErrors.log",{bubbles:!0,detail:{error:Error("myFT form submitted without a CSRF token"),info:{action:r,actorType:d,actorId:i,relationshipName:t,subjectType:f,subjectId:s,formData:c}}})),o.default[r](d,i,t,f,s,c,u).then((function(){n&&"add"===r&&"followed"===t&&N(s)})).catch((function(t){throw setTimeout((function(){return e.querySelector("button").removeAttribute("disabled")}),1e3),t}))}},V=new k.default(document.body);function Z(t,e){return function(n,r){return n.preventDefault(),J(e,r,t.myftOfferInstantAlertNotifications)}}var H=function(t){var e,n,r,o,i;t.anonymous||v(),Y||(Y=!0,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;[a.followed.uiSelector,a.saved.uiSelector,'[data-myft-ui="instant"]'].forEach((function(e){Array.from(t.querySelectorAll(e)).forEach((function(t){t.dataset.jsAction&&(t.setAttribute("method","POST"),t.setAttribute("action",t.dataset.jsAction),delete t.dataset.jsAction)}))}))}(),t&&t.anonymous?(n=window.location.pathname,r="/products?segID=400863&segmentID=190b4443-dc03-bd53-e79b-b4b6fbd04e64",o="/login".concat(n.length?"?location=".concat(n):""),i={followed:'Please <a href="'.concat(r,'" class="myft-ui-subscribe" data-trackable="Subscribe">subscribe</a> or <a href="').concat(o,'" data-trackable="Sign In">sign in</a> to add this topic to myFT.'),saved:'Please <a href="'.concat(r,'" class="myft-ui-subscribe" data-trackable="Subscribe">subscribe</a> or <a href="').concat(o,'" data-trackable="Sign In">sign in</a> to save this article.')},["followed","saved"].forEach((function(t){V.on("submit",a[t].uiSelector,(function(e){e.preventDefault(),j.default.show({content:i[t],trackable:"myft-anon",focusSelector:".myft-ui-subscribe",returnFocusSelector:document.activeElement,duration:0})}))}))):(t.flags&&t.flags.myftOfferInstantAlertNotifications&&(e=t.flags.fcmSwitch,D&&window.ServiceWorkerRegistration&&"showNotification"in window.ServiceWorkerRegistration.prototype&&"PushManager"in window?(O=e?{userVisibleOnly:!0,applicationServerKey:F("BFJGSlVTZ08KYS3heiwOovUPEURcYea478jEXXA5luZ1wo6O6MJ_o2NQckxHudMxa15tOh3YcjDZ-_bKZkPG274")}:{userVisibleOnly:!0},navigator.serviceWorker.ready.then((function(t){L=!0,t.pushManager.getSubscription().then((function(t){return!!t&&(U(t),!0)}))}))):Promise.reject()),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(a).forEach((function(e){var n=a[e].uiSelector;n&&(u(e).then((function(){var t=c(e);if(t.length>0){var n=t.map((function(t){return t.uuid}));h(e,n,!0)}})),["add","remove","update"].forEach((function(t){var n=a[e].actorType,r=a[e].subjectType,o="myft.".concat(n,".").concat(e,".").concat(r,".").concat(t);document.body.addEventListener(o,(function(n){var o=n.detail.results&&n.detail.results[0],a=!!n.detail.results;g(e,n.detail.subject,a,void 0,o,!0),x({subjectType:r,action:t,subjectId:n.detail.subject,postedData:n.detail.data,resultData:o,trackingInfo:n.detail.trackingInfo})}))})),V.on("submit",n,Z(t,e)))}))}(t.flags),_()))},$=n("20ee13ff"),B=n("ddbd4943"),G=new k.default(document.body),X=y();function Q(t,e,n){return g("contained",e,n),o.default.personaliseUrl("/myft/list/".concat(t)).then((function(t){var e='\n\t\t\t\t<a href="/myft" class="myft-ui__logo" data-trackable="myft-logo"><abbr title="myFT" class="myft-ui__icon"></abbr></a>\n\t\t\t\t\t'.concat(n?'Article added to your list.\n\t\t\t\t<a href="'.concat(t,'" data-trackable="alerts">View list</a>'):"Article removed from your list","\n\t\t\t");e&&j.default.show({content:e,trackable:"myft-feedback-notification"})}))}function z(t,e,n){o.default.personaliseUrl(e).then((function(t){return fetch(t,{credentials:"same-origin"})})).then((function(t){if(t.ok)return t.text();throw new Error("Unexpected response: ".concat(t.statusText))})).then((function(e){return function(t,e){var n=e.name,r=void 0===n?"myft-ui":n,o=e.title,a=void 0===o?"&nbsp;":o,i=e.shaded,c=void 0!==i&&i,u=$.default.getOverlays()[r];u&&u.destroy();var l=new $.default(r,{heading:{title:a,shaded:c},html:t});return l.open(),new Promise((function(t){document.body.addEventListener("oOverlay.ready",(function(){return t(l)}))}))}(e,{name:"myft-lists",title:t})})).then((function(t){B.default.init(t.content),function(t,e){var n=t.content.querySelector(".js-save-to-existing-list"),r=t.content.querySelector(".js-list-select");n&&n.addEventListener("click",(function(n){if(n.preventDefault(),r.value){var a=r.options[r.selectedIndex].value;o.default.add("list",a,"contained","content",e,{token:X}).then((function(e){Q(e.actorId,e.subjectId,!!e.results),t.close()}))}}))}(t,n),function(t,e){var n=t.content.querySelector(".js-create-list"),r=t.content.querySelector(".js-name");n.addEventListener("click",(function(n){if(n.preventDefault(),r.value){var a={token:X,name:r.value};o.default.add("user",null,"created","list",Object(T.uuid)(),a).then((function(t){return e?o.default.add("list",t.subject,"contained","content",e,{token:X}):t})).then((function(n){e&&Q(n.actorId,e,!!n.results),t.close()})).catch((function(t){throw j.default.show({content:e?"Error adding article to new list":"Error creating new list",type:"error"}),t}))}}))}(t,n)})).catch((function(t){throw j.default.show({content:"Sorry, something went wrong",type:"error"}),t}))}function tt(t){return o.default.getAll("created","list").then((function(t){return t.filter((function(t){return!t.isRedirect}))})).then((function(e){e.length&&function(t){z("Article saved","/myft/list?fragment=true&fromArticleSaved=true&contentId=".concat(t),t)}(t)}))}function et(){document.body.addEventListener("myft.user.saved.content.add",(function(t){tt(t.detail.subject)})),G.on("click",'[data-myft-ui="copy-to-list"]',(function(t){var e,n;t.preventDefault(),e=t.target.getAttribute("data-content-id"),n=t.target.getAttribute("data-actor-id"),z("Copy to list","/myft/list?fragment=true&copy=true&contentId=".concat(e,"&excludeList=").concat(n),e)})),G.on("click",'[data-myft-ui="create-list"]',(function(t){t.preventDefault(),z("Create list","/myft/list?fragment=true")}))}var nt=function(t){_(t),Object.keys(a).forEach((function(e){var n=c(e);n.length>0&&h(e,n.map((function(t){return t.uuid})),!0,t)})),v({container:t})},rt=n("616ba185"),ot=window.location.pathname.startsWith("/myft"),at=!document.referrer||!new URL(document.referrer).hostname.endsWith("ft.com"),it=document.querySelector(".o-header__top-link--myft"),ct=window.FT&&window.FT.flags&&window.FT.flags.get("myFT_HeaderTooltip");function ut(t){H(t),et(),function(){if(at&&!ot&&it&&ct)o.default.getAll("followed","concept").then((function(t){if(t.length){var e=t.sort((function(t,e){return e.lastPublished-t.lastPublished})).map((function(t){var e=t.name;return'<span style="no-wrap">'.concat(e,"</span>")})).slice(0,3),n="Read the latest on ";3===e.length&&(n+="".concat(e.shift(),", ")),n+=e.join(" and "),n+=" stories.",new rt.default(it,{target:"myft-header-tooltip",content:n,showOnConstruction:!0,position:"below"})}}))}()}},"2588dbc0":function(t,e){t.exports={toggleState:function(t,e){var n=t.getAttribute("aria-label"),r=t.getAttribute("data-alternate-label");n&&(t.setAttribute("aria-label",r),t.setAttribute("title",r),t.setAttribute("data-alternate-label",n));var o=t.textContent||t.innerText;if(o){var a=t.getAttribute("data-text-variant"),i=t.querySelector("[data-variant-label]"),c=a&&i?i:t,u=t.getAttribute("data-alternate-text")||r;if(c.textContent=u,a){var l=u.includes("Saved")?"Save ":"Saved ";t.setAttribute("data-alternate-text",l)}else t.setAttribute("data-alternate-text",o)}var s="true"===t.getAttribute("aria-pressed");return e||t.setAttribute("aria-pressed",!s),t.dispatchEvent(new CustomEvent("nButtons.stateChange",{detail:{state:s},bubbles:!0})),t}}},f9e8967f:function(t,e,n){var r=n("20ee13ff").default,o=function(t){return"\n<div class='instant-alerts-confirmation__info'>\n\t<div class='instant-alerts-confirmation-info__icon'></div>\n\t<div class='instant-alerts-confirmation-info__text'>Would you like to receive instant alerts on this device?</div>\n</div>\n".concat(t?"<div class='instant-alerts-confirmation-info__subtext'>Unblock notifications to receive them on this device.</div>":"",'\n<div class=\'instant-alerts-confirmation__buttons\'>\n\t<button\n\t\t\tclass="o-buttons o-buttons--secondary instant-alerts-confirmation__button js-instant-alerts-confirmation-no"\n\t\t\tdata-trackable="decline-instant-alerts"\n\t\t\ttype="submit"\n\t\t\taria-label="Not now"\n\t\t\ttitle="Not now">\n\t\tNot now\n\t</button><button\n\t\t\tclass="o-buttons o-buttons--primary instant-alerts-confirmation__button js-instant-alerts-confirmation-yes"\n\t\t\tdata-trackable="accept-instant-alerts"\n\t\t\ttype="submit"\n\t\t\taria-label="Yes"\n\t\t\ttitle="Yes">\n\t\tYes\n\t</button>\n\t</div>\n</div>\n')};t.exports=function(t){var e=r.getOverlays()["instant-alerts-confirmation"];e&&e.destroy();var n=new r("instant-alerts-confirmation",{heading:{title:'You have added this topic to <abbr title="myFT" class="myft-ui__icon"></abbr>',shaded:!1},modal:!0,html:o(t)});return n.open(),n}}}]);
//# sourceMappingURL=n-myft-ui.78a50e3b14f3.bundle.js.map